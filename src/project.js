require=function t(e,i,o){function n(c,a){if(!i[c]){if(!e[c]){var r="function"==typeof require&&require;if(!a&&r)return r(c,!0);if(s)return s(c,!0);var h=new Error("Cannot find module '"+c+"'");throw h.code="MODULE_NOT_FOUND",h}var l=i[c]={exports:{}};e[c][0].call(l.exports,function(t){var i=e[c][1][t];return n(i?i:t)},l,l.exports,t,e,i,o)}return i[c].exports}for(var s="function"==typeof require&&require,c=0;c<o.length;c++)n(o[c]);return n}({abstacle:[function(t,e,i){"use strict";cc._RFpush(e,"5bb87EqjMRLM6cZAct1WKvO","abstacle");var o=t("./collid");t("./config");cc.Class({"extends":cc.Component,properties:{otherBall:void 0,mass:1e16,velocityX:0,velocityY:0,bumpAudio:{"default":null,url:cc.AudioClip}},onCollisionEnter:function(t,e){cc.log("a");var i=t.getComponent("chess");if(i.otherBall)return this.velocityX=i.otherBall.velocityX,this.velocityY=i.otherBall.velocityY,void(i.otherBall=void 0);var n=(0,o.ballFactory)(this.node.x,this.node.y,this.velocityX,this.velocityY,this.mass),s=(0,o.ballFactory)(t.node.x,t.node.y,i.velocityX,i.velocityY,i.mass),c=(0,o.collideBalls)(n,s);this.otherBall=c.other,cc.audioEngine.playEffect(this.bumpAudio,!1)},onLoad:function(){},onDestroy:function(){},update:function(t){}}),cc._RFpop()},{"./collid":"collid","./config":"config"}],chess:[function(t,e,i){"use strict";cc._RFpush(e,"a757adOSftILZOVo213y/Ih","chess");var o=t("./collid"),n=t("./config");cc.Class({"extends":cc.Component,properties:{color:{"default":""},bumpAudio:{"default":null,url:cc.AudioClip},dropAudio:{"default":null,url:cc.AudioClip},world:void 0,velocityX:0,velocityY:5,otherBall:void 0,mass:5,draw:void 0,minIndicatorWidth:1.5,maxIndicatorWidth:6,instantVx:0,instantVy:0,breathState:"up",opacityCopy:void 0},judgeOut:function(){var t=this.node.x,e=this.node.y,i=!1;-320<t<-250?this.node.opacity=1.5*(-t-282):t<-319?i=!0:320>t>260?this.node.opacity=1.7*(t-260):t>319&&(i=!0),-610<e<-580?this.node.opacity=3.4*(-e-580):e<-609?i=!0:630>e>590?this.node.opacity=2.5*(e-590):e>629&&(i=!0),i&&(this.playdropSound(),this.world.jellyOut(this.color),cc.removeSelf(),this.node.destroy())},bounce:function(){this.velocityX=this.instantVx,this.velocityY=this.instantVy,this.world.onMove()},drawIndicator:function(t){function e(t,e,i,o){var n=(i-o)/(e-0),s=o;return n*t+s}t=cc.p(t.x,t.y);var i=this.node.getPosition(),o=this.node.parent.convertToNodeSpaceAR(t),s=void 0,c=cc.pDistance(i,o),a=(o.y-i.y)/(o.x-i.x),r=o.y-a*o.x,h=(o.x-i.x)/c;if(c>n.config.maxlength){c=n.config.maxlength;var l=void 0,d=void 0;if(isFinite(a)){var u=i.x,f=i.y,y=n.config.maxlength,v=function(t){return t*t},p=function(t){return Math.sqrt(t)},g=p(-v(r)-2*r*u*a+2*r*f-v(u)*v(a)+2*u*f*a-v(f)+v(a)*v(y)+v(y)),m=(-g-r*a+u+f*a)/(v(a)+1),C=(g-r*a+u+f*a)/(v(a)+1);l=cc.p(m,a*m+r),d=cc.p(C,a*C+r)}else l=cc.p(i.x,i.y+n.config.maxlength),d=cc.p(i.x,i.y-n.config.maxlength);cc.pDistanceSQ(l,o)<cc.pDistanceSQ(d,o)?(o=l,s=d):(o=d,s=l)}else s=cc.pRotateByAngle(o,i,Math.PI);var w=20,x=Math.PI/6;this.world.draw.clear();var b=e(c,n.config.maxlength,this.minIndicatorWidth,this.maxIndicatorWidth);this.world.draw.drawSegment(i,o,b,cc.Color.WHITE);var M=void 0;if(isFinite(a)){var T=s.x+w*h,E=a*T+r;M=cc.p(T,E)}else M=cc.p(s.x,s+w);var B=cc.pRotateByAngle(M,s,x),S=cc.pRotateByAngle(M,s,-x);this.world.draw.drawSegment(s,B,b,cc.Color.WHITE),this.world.draw.drawSegment(s,S,b,cc.Color.WHITE),this.world.draw.drawSegment(i,s,b,cc.Color.WHITE),this.world.draw.drawDot(o,2*b,cc.Color.BLUE),this.instantVy=(s.y-i.y)/n.config.lengthScaleVelocity,this.instantVx=(s.x-i.x)/n.config.lengthScaleVelocity},clearIndicator:function(t){this.world.draw.clear()},onTouchStart:function(t){this.world.changeChessBreath(this.color,!1,220),this.node.opacity=100,this.drawIndicator(t.getLocation())},onTouchMove:function(t){this.drawIndicator(t.getLocation())},onTouchEndAndCancel:function(t){this.node.opacity=220,this.clearIndicator(),this.bounce()},onCollisionEnter:function(t,e){var i=t.getComponent("chess");if(i||(i=t.getComponent("abstacle")),i.otherBall)return this.velocityX=i.otherBall.velocityX,this.velocityY=i.otherBall.velocityY,void(i.otherBall=void 0);this.playbumpSound();var n=(0,o.ballFactory)(this.node.x,this.node.y,this.velocityX,this.velocityY,this.mass),s=(0,o.ballFactory)(t.node.x,t.node.y,i.velocityX,i.velocityY,i.mass),c=(0,o.collideBalls)(n,s);this.velocityX=c.self.velocityX,this.velocityY=c.self.velocityY,this.otherBall=c.other},playbumpSound:function(){cc.audioEngine.playEffect(this.bumpAudio,!1)},playdropSound:function(){cc.audioEngine.playEffect(this.dropAudio,!1)},setListeners:function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEndAndCancel,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEndAndCancel,this)},clearListeners:function(){this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this.onTouchEndAndCancel,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEndAndCancel,this)},onLoad:function(){this.setListeners()},onDestroy:function(){this.clearListeners()},minusVelocityByFriction:function(t){var e=n.config.gravity,i=n.config.frictionCoefficient;return t>0?Math.max(0,t-e*i):0===t?0:t<0?Math.min(0,t+e*i):void 0},breath:function(t){var e=220,i=100,o=2;if("stop"!==this.breathState){var n=(e-i)/o*t;"up"===this.breathState?(this.node.opacity=Math.min(this.node.opacity+n,e),this.breathState=this.node.opacity===e?"down":"up"):"down"===this.breathState&&(this.node.opacity=Math.max(this.node.opacity-n,i),this.breathState=this.node.opacity===i?"up":"down")}},update:function(t){this.breath(t),this.node.x+=this.velocityX,this.node.y+=this.velocityY,this.velocityX=this.minusVelocityByFriction(this.velocityX),this.velocityY=this.minusVelocityByFriction(this.velocityY),this.judgeOut()}}),cc._RFpop()},{"./collid":"collid","./config":"config"}],collid:[function(t,e,i){"use strict";function o(t,e,i,o,n){var s={};return s.x=t,s.y=e,s.velocityX=i,s.velocityY=o,s.mass=n,s}function n(t,e){t=JSON.parse(JSON.stringify(t)),e=JSON.parse(JSON.stringify(e));var i=t.x-e.x,o=t.y-e.y,n=Math.atan2(o,i),s=Math.sqrt(t.velocityX*t.velocityX+t.velocityY*t.velocityY),c=Math.sqrt(e.velocityX*e.velocityX+e.velocityY*e.velocityY),a=Math.atan2(t.velocityY,t.velocityX),r=Math.atan2(e.velocityY,e.velocityX),h=s*Math.cos(a-n),l=s*Math.sin(a-n),d=c*Math.cos(r-n),u=c*Math.sin(r-n),f=((t.mass-e.mass)*h+(e.mass+e.mass)*d)/(t.mass+e.mass),y=((t.mass+t.mass)*h+(e.mass-t.mass)*d)/(t.mass+e.mass),v=l,p=u;return t.velocityX=Math.cos(n)*f+Math.cos(n+Math.PI/2)*v,t.velocityY=Math.sin(n)*f+Math.sin(n+Math.PI/2)*v,e.velocityX=Math.cos(n)*y+Math.cos(n+Math.PI/2)*p,e.velocityY=Math.sin(n)*y+Math.sin(n+Math.PI/2)*p,{self:t,other:e}}cc._RFpush(e,"01aa1hC3TxO9Kbjnthibx9c","collid"),Object.defineProperty(i,"__esModule",{value:!0}),i.ballFactory=o,i.collideBalls=n,cc._RFpop()},{}],config:[function(t,e,i){"use strict";cc._RFpush(e,"35a6cEY/ZNNNpab0MNhHwnJ","config"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){var t=15,e=150,i=e/t,o=9.8,n=.005;return{maxVelocity:t,maxlength:e,lengthScaleVelocity:i,gravity:o,frictionCoefficient:n,size:{small:{scale:.3,mass:2},medium:{scale:.4,mass:5},big:{scale:.6,mass:10}}}}();i.config=o,cc._RFpop()},{}],game:[function(t,e,i){"use strict";cc._RFpush(e,"b41ffrKsfZKiIM9N/TEIHCC","game");var o=t("./config");cc.Class({"extends":cc.Component,properties:{greenJellyPrefab:{"default":null,type:cc.Prefab},redJellyPrefab:{"default":null,type:cc.Prefab},world:{"default":null},victoryPrefab:{"default":null,type:cc.Prefab},failurePrefab:{"default":null,type:cc.Prefab},restartPrefab:{"default":null,type:cc.Prefab},draw:void 0,greenCnt:0,redCnt:0,firstChess:"green",nowChess:void 0,isMoving:!1},setCollision:function(){var t=cc.director.getCollisionManager();t.enabled=!0},setDrawNode:function(){this.draw=new cc.DrawNode,this.node._sgNode.addChild(this.draw)},jellyOut:function(t){"red"===t?this.redCnt-=1:this.greenCnt-=1,this.checkGameEnd()},checkGameEnd:function(){this.redCnt<=0&&this.greenCnt>0?(this.spawnNewBanner(cc.instantiate(this.failurePrefab),1),this.spawnNewBanner(cc.instantiate(this.victoryPrefab),0),this.changeChessListener(void 0,!1),this.soawnRestartButton()):this.greenCnt<=0&&this.redCnt>0&&(this.spawnNewBanner(cc.instantiate(this.failurePrefab),0),this.spawnNewBanner(cc.instantiate(this.victoryPrefab),1),this.changeChessListener(void 0,!1),this.soawnRestartButton())},spawnNewBanner:function(t,e){this.node.addChild(t,1,"banner"),e?(t.setPosition(cc.p(10,364)),t.rotation=180):t.setPosition(cc.p(-6,-351))},soawnRestartButton:function(){var t=cc.instantiate(this.restartPrefab);this.node.addChild(t,1,"restart"),t.setPosition(cc.p(0,0)),t.on(cc.Node.EventType.TOUCH_START,this.onButtonTouchStart,this)},mapChess:function(t){for(var e=this.node.children,i=0;i<e.length;++i){var o=e[i].getComponent("chess");o&&t(o)}},changeChessBreath:function(t,e,i){this.mapChess(function(o){t&&o.color!==t||(i&&(o.node.opacity=i),o.breathState=e?"up":"stop")})},changeChessListener:function(t,e){this.mapChess(function(i){t&&i.color!==t||(e?i.setListeners():i.clearListeners())})},onButtonTouchStart:function(){this.newGame()},spawnJellies:function(){for(var t=[{size:"small",name:"red-1",color:"red",x:208,y:231},{size:"small",name:"red-2",color:"red",x:-208,y:231},{size:"small",name:"red-3",color:"red",x:0,y:231},{size:"small",name:"green-1",color:"green",x:208,y:-231},{size:"small",name:"green-2",color:"green",x:-208,y:-231},{size:"small",name:"green-3",color:"green",x:0,y:-231},{size:"medium",name:"red-4",color:"red",x:180,y:400},{size:"medium",name:"red-5",color:"red",x:-180,y:400},{size:"medium",name:"green-4",color:"green",x:180,y:-400},{size:"medium",name:"green-5",color:"green",x:-180,y:-400},{size:"big",name:"green-6",color:"green",x:0,y:-400},{size:"big",name:"red-6",color:"red",x:0,y:400}],e=-5,i=0,n=0;n<t.length;++n){var s=t[n],c=void 0;"red"===s.color?(c=cc.instantiate(this.redJellyPrefab),this.redCnt+=1):(c=cc.instantiate(this.greenJellyPrefab),this.greenCnt+=1);var a=c.getComponent("chess");a.world=this,a.mass=o.config.size[s.size].mass,c.scale=o.config.size[s.size].scale,this.node.addChild(c,1,s.name),c.setPosition(cc.p(s.x+e,s.y+i))}},toggleCheese:function(t){return"red"===t?"green":"red"},newGame:function(){this.redCnt=0,this.greenCnt=0,this.node.removeAllChildren(),this.spawnJellies(),this.nowChess=this.firstChess,this.changeChessListener(this.nowChess,!0),this.changeChessListener(this.toggleCheese(this.nowChess),!1),this.changeChessBreath(this.nowChess,!0),this.changeChessBreath(this.toggleCheese(this.nowChess),!1),this.firstChess=this.toggleCheese(this.firstChess)},checkAllStop:function(){for(var t=this.node.children,e=0;e<t.length;++e){var i=t[e].getComponent("chess");if(i&&(0!==i.velocityX||0!==i.velocityY))return!1}return!0},onLoad:function(){this.setDrawNode(),this.setCollision(),this.newGame()},onDestroy:function(){},onMove:function(){this.isMoving=!0,this.changeChessListener(void 0,!1),this.changeChessBreath(void 0,!1)},onMoveEnd:function(){this.isMoving=!1,this.nowChess=this.toggleCheese(this.nowChess),this.changeChessListener(this.nowChess,!0),this.changeChessBreath(this.nowChess,!0)},update:function(t){this.isMoving&&this.checkAllStop()&&this.onMoveEnd()}}),cc._RFpop()},{"./config":"config"}]},{},["collid","config","abstacle","chess","game"]);
//# sourceMappingURL=project.js.map